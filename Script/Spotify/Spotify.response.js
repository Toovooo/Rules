class e{static name="Lodash";static version="1.2.2";static about(){return console.log(`\n🟧 ${this.name} v${this.version}\n`)}static get(e={},t="",s=void 0){Array.isArray(t)||(t=this.toPath(t));const n=t.reduce(((e,t)=>Object(e)[t]),e);return void 0===n?s:n}static set(e={},t="",s){return Array.isArray(t)||(t=this.toPath(t)),t.slice(0,-1).reduce(((e,s,n)=>Object(e[s])===e[s]?e[s]:e[s]=/^\d+$/.test(t[n+1])?[]:{}),e)[t[t.length-1]]=s,e}static unset(e={},t=""){return Array.isArray(t)||(t=this.toPath(t)),t.reduce(((e,s,n)=>n===t.length-1?(delete e[s],!0):Object(e)[s]),e)}static toPath(e){return e.replace(/\[(\d+)\]/g,".$1").split(".").filter(Boolean)}static escape(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e.replace(/[&<>"']/g,(e=>t[e]))}static unescape(e){const t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};return e.replace(/&amp;|&lt;|&gt;|&quot;|&#39;/g,(e=>t[e]))}}class t{static name="$Storage";static version="1.0.9";static about(){return console.log(`\n🟧 ${this.name} v${this.version}\n`)}static data=null;static dataFile="box.dat";static#e=/^@(?<key>[^.]+)(?:\.(?<path>.*))?$/;static#t(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof module&&module.exports?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":"undefined"!=typeof Egern?"Egern":void 0}static getItem(t=new String,s=null){let n=s;if(!0===t.startsWith("@")){const{key:s,path:r}=t.match(this.#e)?.groups;t=s;let a=this.getItem(t,{});"object"!=typeof a&&(a={}),n=e.get(a,r);try{n=JSON.parse(n)}catch(e){}}else{switch(this.#t()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":n=$persistentStore.read(t);break;case"Quantumult X":n=$prefs.valueForKey(t);break;case"Node.js":this.data=this.#s(this.dataFile),n=this.data?.[t];break;default:n=this.data?.[t]||null}try{n=JSON.parse(n)}catch(e){}}return n??s}static setItem(t=new String,s=new String){let n=!1;if("object"==typeof s)s=JSON.stringify(s);else s=String(s);if(!0===t.startsWith("@")){const{key:r,path:a}=t.match(this.#e)?.groups;t=r;let i=this.getItem(t,{});"object"!=typeof i&&(i={}),e.set(i,a,s),n=this.setItem(t,i)}else switch(this.#t()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":n=$persistentStore.write(s,t);break;case"Quantumult X":n=$prefs.setValueForKey(s,t);break;case"Node.js":this.data=this.#s(this.dataFile),this.data[t]=s,this.#n(this.dataFile),n=!0;break;default:n=this.data?.[t]||null}return n}static removeItem(t){let s=!1;if(!0===t.startsWith("@")){const{key:n,path:r}=t.match(this.#e)?.groups;t=n;let a=this.getItem(t);"object"!=typeof a&&(a={}),keyValue=e.unset(a,r),s=this.setItem(t,a)}else switch(this.#t()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Node.js":default:s=!1;break;case"Quantumult X":s=$prefs.removeValueForKey(t)}return s}static clear(){let e=!1;switch(this.#t()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Node.js":default:e=!1;break;case"Quantumult X":e=$prefs.removeAllValues()}return e}static#s(e){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(e),s=this.path.resolve(process.cwd(),e),n=this.fs.existsSync(t),r=!n&&this.fs.existsSync(s);if(!n&&!r)return{};{const e=n?t:s;try{return JSON.parse(this.fs.readFileSync(e))}catch(e){return{}}}}}static#n(e=this.dataFile){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(e),s=this.path.resolve(process.cwd(),e),n=this.fs.existsSync(t),r=!n&&this.fs.existsSync(s),a=JSON.stringify(this.data);n?this.fs.writeFileSync(t,a):r?this.fs.writeFileSync(s,a):this.fs.writeFileSync(t,a)}}}class s{static name="ENV";static version="1.7.4";static about(){return console.log(`\n🟧 ${this.name} v${this.version}\n`)}constructor(e,t){console.log(`\n🟧 ${s.name} v${s.version}\n`),this.name=e,this.logs=[],this.isMute=!1,this.isMuteLog=!1,this.logSeparator="\n",this.encoding="utf-8",this.startTime=(new Date).getTime(),Object.assign(this,t),this.log(`\n🚩 开始!\n${e}\n`)}platform(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof module&&module.exports?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":"undefined"!=typeof Egern?"Egern":void 0}isNode(){return"Node.js"===this.platform()}isQuanX(){return"Quantumult X"===this.platform()}isSurge(){return"Surge"===this.platform()}isLoon(){return"Loon"===this.platform()}isShadowrocket(){return"Shadowrocket"===this.platform()}isStash(){return"Stash"===this.platform()}isEgern(){return"Egern"===this.platform()}async getScript(e){return await this.fetch(e).then((e=>e.body))}async runScript(e,s){let n=t.getItem("@chavy_boxjs_userCfgs.httpapi");n=n?.replace?.(/\n/g,"")?.trim();let r=t.getItem("@chavy_boxjs_userCfgs.httpapi_timeout");r=1*r??20,r=s?.timeout??r;const[a,i]=n.split("@"),o={url:`http://${i}/v1/scripting/evaluate`,body:{script_text:e,mock_type:"cron",timeout:r},headers:{"X-Key":a,Accept:"*/*"},timeout:r};await this.fetch(o).then((e=>e.body),(e=>this.logErr(e)))}initGotEnv(e){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,e&&(e.headers=e.headers?e.headers:{},void 0===e.headers.Cookie&&void 0===e.cookieJar&&(e.cookieJar=this.ckjar))}async fetch(t={}||"",s={}){switch(t.constructor){case Object:t={...t,...s};break;case String:t={url:t,...s}}t.method||(t.method="GET",(t.body??t.bodyBytes)&&(t.method="POST")),delete t.headers?.Host,delete t.headers?.[":authority"],delete t.headers?.["Content-Length"],delete t.headers?.["content-length"];const n=t.method.toLocaleLowerCase();switch(this.platform()){case"Loon":case"Surge":case"Stash":case"Egern":case"Shadowrocket":default:return t.policy&&(this.isLoon()&&(t.node=t.policy),this.isStash()&&e.set(t,"headers.X-Stash-Selected-Proxy",encodeURI(t.policy))),"boolean"==typeof t.redirection&&(t["auto-redirect"]=t.redirection),t.bodyBytes&&!t.body&&(t.body=t.bodyBytes,delete t.bodyBytes),await new Promise(((e,s)=>{$httpClient[n](t,((n,r,a)=>{n?s(n):(r.ok=/^2\d\d$/.test(r.status),r.statusCode=r.status,a&&(r.body=a,1==t["binary-mode"]&&(r.bodyBytes=a)),e(r))}))}));case"Quantumult X":return t.policy&&e.set(t,"opts.policy",t.policy),"boolean"==typeof t["auto-redirect"]&&e.set(t,"opts.redirection",t["auto-redirect"]),t.body instanceof ArrayBuffer?(t.bodyBytes=t.body,delete t.body):ArrayBuffer.isView(t.body)?(t.bodyBytes=t.body.buffer.slice(t.body.byteOffset,t.body.byteLength+t.body.byteOffset),delete object.body):t.body&&delete t.bodyBytes,await $task.fetch(t).then((e=>(e.ok=/^2\d\d$/.test(e.statusCode),e.status=e.statusCode,e)),(e=>Promise.reject(e.error)));case"Node.js":let s=require("iconv-lite");this.initGotEnv(t);const{url:r,...a}=t;return await this.got[n](r,a).on("redirect",((e,t)=>{try{if(e.headers["set-cookie"]){const s=e.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),t.cookieJar=this.ckjar}}catch(e){this.logErr(e)}})).then((e=>(e.statusCode=e.status,e.body=s.decode(e.rawBody,this.encoding),e.bodyBytes=e.rawBody,e)),(e=>Promise.reject(e.message)))}}time(e,t=null){const s=t?new Date(t):new Date;let n={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let t in n)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?n[t]:("00"+n[t]).substr((""+n[t]).length)));return e}msg(e=name,t="",s="",n){const r=e=>{switch(typeof e){case void 0:return e;case"string":switch(this.platform()){case"Surge":case"Stash":case"Egern":default:return{url:e};case"Loon":case"Shadowrocket":return e;case"Quantumult X":return{"open-url":e};case"Node.js":return}case"object":switch(this.platform()){case"Surge":case"Stash":case"Egern":case"Shadowrocket":default:return{url:e.url||e.openUrl||e["open-url"]};case"Loon":return{openUrl:e.openUrl||e.url||e["open-url"],mediaUrl:e.mediaUrl||e["media-url"]};case"Quantumult X":return{"open-url":e["open-url"]||e.url||e.openUrl,"media-url":e["media-url"]||e.mediaUrl,"update-pasteboard":e["update-pasteboard"]||e.updatePasteboard};case"Node.js":return}default:return}};if(!this.isMute)switch(this.platform()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":default:$notification.post(e,t,s,r(n));break;case"Quantumult X":$notify(e,t,s,r(n));case"Node.js":}if(!this.isMuteLog){let n=["","==============📣系统通知📣=============="];n.push(e),t&&n.push(t),s&&n.push(s),console.log(n.join("\n")),this.logs=this.logs.concat(n)}}log(...e){e.length>0&&(this.logs=[...this.logs,...e]),console.log(e.join(this.logSeparator))}logErr(e){switch(this.platform()){case"Surge":case"Loon":case"Stash":case"Egern":case"Shadowrocket":case"Quantumult X":default:this.log("",`❗️ ${this.name}, 错误!`,e);break;case"Node.js":this.log("",`❗️${this.name}, 错误!`,e.stack)}}wait(e){return new Promise((t=>setTimeout(t,e)))}done(t={}){const s=((new Date).getTime()-this.startTime)/1e3;switch(this.log("",`🚩 ${this.name}, 结束! 🕛 ${s} 秒`,""),this.platform()){case"Surge":t.policy&&e.set(t,"headers.X-Surge-Policy",t.policy),$done(t);break;case"Loon":t.policy&&(t.node=t.policy),$done(t);break;case"Stash":t.policy&&e.set(t,"headers.X-Stash-Selected-Proxy",encodeURI(t.policy)),$done(t);break;case"Egern":case"Shadowrocket":default:$done(t);break;case"Quantumult X":t.policy&&e.set(t,"opts.policy",t.policy),delete t["auto-redirect"],delete t["auto-cookie"],delete t["binary-mode"],delete t.charset,delete t.host,delete t.insecure,delete t.method,delete t.opt,delete t.path,delete t.policy,delete t["policy-descriptor"],delete t.scheme,delete t.sessionIndex,delete t.statusCode,delete t.timeout,t.body instanceof ArrayBuffer?(t.bodyBytes=t.body,delete t.body):ArrayBuffer.isView(t.body)?(t.bodyBytes=t.body.buffer.slice(t.body.byteOffset,t.body.byteLength+t.body.byteOffset),delete t.body):t.body&&delete t.bodyBytes,$done(t);break;case"Node.js":process.exit(1)}}}var n={Switch:!0,Type:"Translate",Types:["Official","Translate"],Languages:["EN","ZH"],CacheSize:50},r={breakLine:{"text/xml":"&#x000A;","application/xml":"&#x000A;","text/vtt":"\n","application/vtt":"\n","text/json":"\n","application/json":"\n"}},a={Settings:n,Configs:r},i={Switch:!0,Types:["Translate","External"],Languages:["AUTO","ZH"]},o={Settings:i},l=Database={Default:Object.freeze({__proto__:null,Configs:r,Settings:n,default:a}),Spotify:Object.freeze({__proto__:null,Settings:i,default:o})};function c(s,n,r){console.log("☑️ Set Environment Variables","");let{Settings:a,Caches:i,Configs:o}=function(s,n,r){let a=t.getItem(s,r),i={};if("undefined"!=typeof $argument&&Boolean($argument)){let t=Object.fromEntries($argument.split("&").map((e=>e.split("=").map((e=>e.replace(/\"/g,""))))));for(let s in t)e.set(i,s,t[s])}const o={Settings:r?.Default?.Settings||{},Configs:r?.Default?.Configs||{},Caches:{}};Array.isArray(n)||(n=[n]);for(let e of n)o.Settings={...o.Settings,...r?.[e]?.Settings,...i,...a?.[e]?.Settings},o.Configs={...o.Configs,...r?.[e]?.Configs},a?.[e]?.Caches&&"string"==typeof a?.[e]?.Caches&&(a[e].Caches=JSON.parse(a?.[e]?.Caches)),o.Caches={...o.Caches,...a?.[e]?.Caches};return function e(t,s){for(var n in t){var r=t[n];t[n]="object"==typeof r&&null!==r?e(r,s):s(n,r)}return t}(o.Settings,((e,t)=>("true"===t||"false"===t?t=JSON.parse(t):"string"==typeof t&&(t=t.includes(",")?t.split(",").map((e=>l(e))):l(t)),t))),o;function l(e){return e&&!isNaN(e)&&(e=parseInt(e,10)),e}}(s,n,r);return Array.isArray(a?.Types)||(a.Types=a.Types?[a.Types]:[]),console.log(`✅ Set Environment Variables, Settings: ${typeof a}, Settings内容: ${JSON.stringify(a)}`,""),("object"!=typeof i?.Playlists||Array.isArray(i?.Playlists))&&(i.Playlists={}),i.Playlists.Master=new Map(JSON.parse(i?.Playlists?.Master||"[]")),i.Playlists.Subtitle=new Map(JSON.parse(i?.Playlists?.Subtitle||"[]")),"object"!=typeof i?.Subtitles&&(i.Subtitles=new Map(JSON.parse(i?.Subtitles||"[]"))),("object"!=typeof i?.Metadatas||Array.isArray(i?.Metadatas))&&(i.Metadatas={}),"object"!=typeof i?.Metadatas?.Tracks&&(i.Metadatas.Tracks=new Map(JSON.parse(i?.Metadatas?.Tracks||"[]"))),{Settings:a,Caches:i,Configs:o}}function u(e){return e["has-audiobooks-subscription"]={boolValue:!0},e["player-license"]={stringValue:"premium"},e.mobile={boolValue:!0},e["financial-product"]={stringValue:"pr:premium,tc:0"},e["premium-mini"]={boolValue:!0},e["streaming-rules"]={stringValue:""},e["license-acceptance-grace-days"]={longValue:"30"},e.name={stringValue:"Spotify Premium"},e["mobile-login"]={boolValue:!0},e["hifi-optin-intent"]={boolValue:!0},e["pick-and-shuffle"]={boolValue:!1},e["on-demand"]={boolValue:!0},e.ads={boolValue:!1},e.catalogue={stringValue:"premium"},e["high-bitrate"]={boolValue:!0},e.libspotify={boolValue:!0},e["nft-disabled"]={stringValue:"1"},e.shuffle={boolValue:!1},e["audio-quality"]={stringValue:"1"},e.offline={boolValue:!0},e["hifi-eligible"]={boolValue:!0},e["pause-after"]={longValue:"0"},e["addon-hifi"]={boolValue:!0},e.can_use_superbird={boolValue:!0},e.type={stringValue:"premium"},e["loudness-levels"]={stringValue:"1:-9.0,0.0,3.0:-2.0"},e["payments-initial-campaign"]={stringValue:"web"},e["shuffle-eligible"]={boolValue:!0},e.unrestricted={boolValue:!0},e["com.spotify.madprops.use.ucs.product.state"]={boolValue:!0},e}function h(e){let t=typeof e;if("object"==t){if(Array.isArray(e))return"array";if(null===e)return"null"}return t}function f(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}let d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),p=[];for(let e=0;e<d.length;e++)p[d[e].charCodeAt(0)]=e;var m,g;function y(){let e=0,t=0;for(let s=0;s<28;s+=7){let n=this.buf[this.pos++];if(e|=(127&n)<<s,0==(128&n))return this.assertBounds(),[e,t]}let s=this.buf[this.pos++];if(e|=(15&s)<<28,t=(112&s)>>4,0==(128&s))return this.assertBounds(),[e,t];for(let s=3;s<=31;s+=7){let n=this.buf[this.pos++];if(t|=(127&n)<<s,0==(128&n))return this.assertBounds(),[e,t]}throw new Error("invalid varint")}function b(e,t,s){for(let n=0;n<28;n+=7){const r=e>>>n,a=!(r>>>7==0&&0==t),i=255&(a?128|r:r);if(s.push(i),!a)return}const n=e>>>28&15|(7&t)<<4,r=!(t>>3==0);if(s.push(255&(r?128|n:n)),r){for(let e=3;e<31;e+=7){const n=t>>>e,r=!(n>>>7==0),a=255&(r?128|n:n);if(s.push(a),!r)return}s.push(t>>>31&1)}}p["-".charCodeAt(0)]=d.indexOf("+"),p["_".charCodeAt(0)]=d.indexOf("/"),function(e){e.symbol=Symbol.for("protobuf-ts/unknown"),e.onRead=(s,n,r,a,i)=>{(t(n)?n[e.symbol]:n[e.symbol]=[]).push({no:r,wireType:a,data:i})},e.onWrite=(t,s,n)=>{for(let{no:t,wireType:r,data:a}of e.list(s))n.tag(t,r).raw(a)},e.list=(s,n)=>{if(t(s)){let t=s[e.symbol];return n?t.filter((e=>e.no==n)):t}return[]},e.last=(t,s)=>e.list(t,s).slice(-1)[0];const t=t=>t&&Array.isArray(t[e.symbol])}(m||(m={})),function(e){e[e.Varint=0]="Varint",e[e.Bit64=1]="Bit64",e[e.LengthDelimited=2]="LengthDelimited",e[e.StartGroup=3]="StartGroup",e[e.EndGroup=4]="EndGroup",e[e.Bit32=5]="Bit32"}(g||(g={}));const w=4294967296;function k(e){let t="-"==e[0];t&&(e=e.slice(1));const s=1e6;let n=0,r=0;function a(t,a){const i=Number(e.slice(t,a));r*=s,n=n*s+i,n>=w&&(r+=n/w|0,n%=w)}return a(-24,-18),a(-18,-12),a(-12,-6),a(-6),[t,n,r]}function T(e,t){if(t>>>0<=2097151)return""+(w*t+(e>>>0));let s=(e>>>24|t<<8)>>>0&16777215,n=t>>16&65535,r=(16777215&e)+6777216*s+6710656*n,a=s+8147497*n,i=2*n,o=1e7;function l(e,t){let s=e?String(e):"";return t?"0000000".slice(s.length)+s:s}return r>=o&&(a+=Math.floor(r/o),r%=o),a>=o&&(i+=Math.floor(a/o),a%=o),l(i,0)+l(a,i)+l(r,1)}function N(e,t){if(e>=0){for(;e>127;)t.push(127&e|128),e>>>=7;t.push(e)}else{for(let s=0;s<9;s++)t.push(127&e|128),e>>=7;t.push(1)}}function S(){let e=this.buf[this.pos++],t=127&e;if(0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<7,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<14,0==(128&e))return this.assertBounds(),t;if(e=this.buf[this.pos++],t|=(127&e)<<21,0==(128&e))return this.assertBounds(),t;e=this.buf[this.pos++],t|=(15&e)<<28;for(let t=5;0!=(128&e)&&t<10;t++)e=this.buf[this.pos++];if(0!=(128&e))throw new Error("invalid varint");return this.assertBounds(),t>>>0}let I;function v(e){if(!e)throw new Error("BigInt unavailable, see https://github.com/timostamm/protobuf-ts/blob/v1.0.8/MANUAL.md#bigint-support")}!function(){const e=new DataView(new ArrayBuffer(8)),t=void 0!==globalThis.BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64;I=t?{MIN:BigInt("-9223372036854775808"),MAX:BigInt("9223372036854775807"),UMIN:BigInt("0"),UMAX:BigInt("18446744073709551615"),C:BigInt,V:e}:void 0}();const E=/^-?[0-9]+$/,O=4294967296,B=2147483648;class V{constructor(e,t){this.lo=0|e,this.hi=0|t}isZero(){return 0==this.lo&&0==this.hi}toNumber(){let e=this.hi*O+(this.lo>>>0);if(!Number.isSafeInteger(e))throw new Error("cannot convert to safe number");return e}}class U extends V{static from(e){if(I)switch(typeof e){case"string":if("0"==e)return this.ZERO;if(""==e)throw new Error("string is no integer");e=I.C(e);case"number":if(0===e)return this.ZERO;e=I.C(e);case"bigint":if(!e)return this.ZERO;if(e<I.UMIN)throw new Error("signed value for ulong");if(e>I.UMAX)throw new Error("ulong too large");return I.V.setBigUint64(0,e,!0),new U(I.V.getInt32(0,!0),I.V.getInt32(4,!0))}else switch(typeof e){case"string":if("0"==e)return this.ZERO;if(e=e.trim(),!E.test(e))throw new Error("string is no integer");let[t,s,n]=k(e);if(t)throw new Error("signed value for ulong");return new U(s,n);case"number":if(0==e)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");if(e<0)throw new Error("signed value for ulong");return new U(e,e/O)}throw new Error("unknown value "+typeof e)}toString(){return I?this.toBigInt().toString():T(this.lo,this.hi)}toBigInt(){return v(I),I.V.setInt32(0,this.lo,!0),I.V.setInt32(4,this.hi,!0),I.V.getBigUint64(0,!0)}}U.ZERO=new U(0,0);class A extends V{static from(e){if(I)switch(typeof e){case"string":if("0"==e)return this.ZERO;if(""==e)throw new Error("string is no integer");e=I.C(e);case"number":if(0===e)return this.ZERO;e=I.C(e);case"bigint":if(!e)return this.ZERO;if(e<I.MIN)throw new Error("signed long too small");if(e>I.MAX)throw new Error("signed long too large");return I.V.setBigInt64(0,e,!0),new A(I.V.getInt32(0,!0),I.V.getInt32(4,!0))}else switch(typeof e){case"string":if("0"==e)return this.ZERO;if(e=e.trim(),!E.test(e))throw new Error("string is no integer");let[t,s,n]=k(e);if(t){if(n>B||n==B&&0!=s)throw new Error("signed long too small")}else if(n>=B)throw new Error("signed long too large");let r=new A(s,n);return t?r.negate():r;case"number":if(0==e)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");return e>0?new A(e,e/O):new A(-e,-e/O).negate()}throw new Error("unknown value "+typeof e)}isNegative(){return 0!=(this.hi&B)}negate(){let e=~this.hi,t=this.lo;return t?t=1+~t:e+=1,new A(t,e)}toString(){if(I)return this.toBigInt().toString();if(this.isNegative()){let e=this.negate();return"-"+T(e.lo,e.hi)}return T(this.lo,this.hi)}toBigInt(){return v(I),I.V.setInt32(0,this.lo,!0),I.V.setInt32(4,this.hi,!0),I.V.getBigInt64(0,!0)}}A.ZERO=new A(0,0);const x={readUnknownField:!0,readerFactory:e=>new $(e)};class ${constructor(e,t){this.varint64=y,this.uint32=S,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=null!=t?t:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0})}tag(){let e=this.uint32(),t=e>>>3,s=7&e;if(t<=0||s<0||s>5)throw new Error("illegal tag: field no "+t+" wire type "+s);return[t,s]}skip(e){let t=this.pos;switch(e){case g.Varint:for(;128&this.buf[this.pos++];);break;case g.Bit64:this.pos+=4;case g.Bit32:this.pos+=4;break;case g.LengthDelimited:let t=this.uint32();this.pos+=t;break;case g.StartGroup:let s;for(;(s=this.tag()[1])!==g.EndGroup;)this.skip(s);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(t,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return new A(...this.varint64())}uint64(){return new U(...this.varint64())}sint64(){let[e,t]=this.varint64(),s=-(1&e);return e=(e>>>1|(1&t)<<31)^s,t=t>>>1^s,new A(e,t)}bool(){let[e,t]=this.varint64();return 0!==e||0!==t}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return new U(this.sfixed32(),this.sfixed32())}sfixed64(){return new A(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function j(e,t){if(!e)throw new Error(t)}function L(e){if("number"!=typeof e)throw new Error("invalid int 32: "+typeof e);if(!Number.isInteger(e)||e>2147483647||e<-2147483648)throw new Error("invalid int 32: "+e)}function D(e){if("number"!=typeof e)throw new Error("invalid uint 32: "+typeof e);if(!Number.isInteger(e)||e>4294967295||e<0)throw new Error("invalid uint 32: "+e)}function F(e){if("number"!=typeof e)throw new Error("invalid float 32: "+typeof e);if(Number.isFinite(e)&&(e>34028234663852886e22||e<-34028234663852886e22))throw new Error("invalid float 32: "+e)}const R={writeUnknownFields:!0,writerFactory:()=>new C};class C{constructor(e){this.stack=[],this.textEncoder=null!=e?e:new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let t=0;t<this.chunks.length;t++)e+=this.chunks[t].length;let t=new Uint8Array(e),s=0;for(let e=0;e<this.chunks.length;e++)t.set(this.chunks[e],s),s+=this.chunks[e].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(D(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return L(e),N(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){F(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){D(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){L(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return L(e),N(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let t=new Uint8Array(8),s=new DataView(t.buffer),n=A.from(e);return s.setInt32(0,n.lo,!0),s.setInt32(4,n.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),s=new DataView(t.buffer),n=U.from(e);return s.setInt32(0,n.lo,!0),s.setInt32(4,n.hi,!0),this.raw(t)}int64(e){let t=A.from(e);return b(t.lo,t.hi,this.buf),this}sint64(e){let t=A.from(e),s=t.hi>>31;return b(t.lo<<1^s,(t.hi<<1|t.lo>>>31)^s,this.buf),this}uint64(e){let t=U.from(e);return b(t.lo,t.hi,this.buf),this}}const M={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0},X={ignoreUnknownFields:!1};function J(e){return e?Object.assign(Object.assign({},M),e):M}const _=Symbol.for("protobuf-ts/message-type");function P(e){let t=!1;const s=[];for(let n=0;n<e.length;n++){let r=e.charAt(n);"_"==r?t=!0:/\d/.test(r)?(s.push(r),t=!0):t?(s.push(r.toUpperCase()),t=!1):0==n?s.push(r.toLowerCase()):s.push(r)}return s.join("")}var K,G,q;function W(e){var t,s,n,r;return e.localName=null!==(t=e.localName)&&void 0!==t?t:P(e.name),e.jsonName=null!==(s=e.jsonName)&&void 0!==s?s:P(e.name),e.repeat=null!==(n=e.repeat)&&void 0!==n?n:q.NO,e.opt=null!==(r=e.opt)&&void 0!==r?r:!e.repeat&&(!e.oneof&&"message"==e.kind),e}function Z(e){if("object"!=typeof e||null===e||!e.hasOwnProperty("oneofKind"))return!1;switch(typeof e.oneofKind){case"string":return void 0!==e[e.oneofKind]&&2==Object.keys(e).length;case"undefined":return 1==Object.keys(e).length;default:return!1}}!function(e){e[e.DOUBLE=1]="DOUBLE",e[e.FLOAT=2]="FLOAT",e[e.INT64=3]="INT64",e[e.UINT64=4]="UINT64",e[e.INT32=5]="INT32",e[e.FIXED64=6]="FIXED64",e[e.FIXED32=7]="FIXED32",e[e.BOOL=8]="BOOL",e[e.STRING=9]="STRING",e[e.BYTES=12]="BYTES",e[e.UINT32=13]="UINT32",e[e.SFIXED32=15]="SFIXED32",e[e.SFIXED64=16]="SFIXED64",e[e.SINT32=17]="SINT32",e[e.SINT64=18]="SINT64"}(K||(K={})),function(e){e[e.BIGINT=0]="BIGINT",e[e.STRING=1]="STRING",e[e.NUMBER=2]="NUMBER"}(G||(G={})),function(e){e[e.NO=0]="NO",e[e.PACKED=1]="PACKED",e[e.UNPACKED=2]="UNPACKED"}(q||(q={}));class Y{constructor(e){var t;this.fields=null!==(t=e.fields)&&void 0!==t?t:[]}prepare(){if(this.data)return;const e=[],t=[],s=[];for(let n of this.fields)if(n.oneof)s.includes(n.oneof)||(s.push(n.oneof),e.push(n.oneof),t.push(n.oneof));else switch(t.push(n.localName),n.kind){case"scalar":case"enum":n.opt&&!n.repeat||e.push(n.localName);break;case"message":n.repeat&&e.push(n.localName);break;case"map":e.push(n.localName)}this.data={req:e,known:t,oneofs:Object.values(s)}}is(e,t,s=!1){if(t<0)return!0;if(null==e||"object"!=typeof e)return!1;this.prepare();let n=Object.keys(e),r=this.data;if(n.length<r.req.length||r.req.some((e=>!n.includes(e))))return!1;if(!s&&n.some((e=>!r.known.includes(e))))return!1;if(t<1)return!0;for(const n of r.oneofs){const r=e[n];if(!Z(r))return!1;if(void 0===r.oneofKind)continue;const a=this.fields.find((e=>e.localName===r.oneofKind));if(!a)return!1;if(!this.field(r[r.oneofKind],a,s,t))return!1}for(const n of this.fields)if(void 0===n.oneof&&!this.field(e[n.localName],n,s,t))return!1;return!0}field(e,t,s,n){let r=t.repeat;switch(t.kind){case"scalar":return void 0===e?t.opt:r?this.scalars(e,t.T,n,t.L):this.scalar(e,t.T,t.L);case"enum":return void 0===e?t.opt:r?this.scalars(e,K.INT32,n):this.scalar(e,K.INT32);case"message":return void 0===e||(r?this.messages(e,t.T(),s,n):this.message(e,t.T(),s,n));case"map":if("object"!=typeof e||null===e)return!1;if(n<2)return!0;if(!this.mapKeys(e,t.K,n))return!1;switch(t.V.kind){case"scalar":return this.scalars(Object.values(e),t.V.T,n,t.V.L);case"enum":return this.scalars(Object.values(e),K.INT32,n);case"message":return this.messages(Object.values(e),t.V.T(),s,n)}}return!0}message(e,t,s,n){return s?t.isAssignable(e,n):t.is(e,n)}messages(e,t,s,n){if(!Array.isArray(e))return!1;if(n<2)return!0;if(s){for(let s=0;s<e.length&&s<n;s++)if(!t.isAssignable(e[s],n-1))return!1}else for(let s=0;s<e.length&&s<n;s++)if(!t.is(e[s],n-1))return!1;return!0}scalar(e,t,s){let n=typeof e;switch(t){case K.UINT64:case K.FIXED64:case K.INT64:case K.SFIXED64:case K.SINT64:switch(s){case G.BIGINT:return"bigint"==n;case G.NUMBER:return"number"==n&&!isNaN(e);default:return"string"==n}case K.BOOL:return"boolean"==n;case K.STRING:return"string"==n;case K.BYTES:return e instanceof Uint8Array;case K.DOUBLE:case K.FLOAT:return"number"==n&&!isNaN(e);default:return"number"==n&&Number.isInteger(e)}}scalars(e,t,s,n){if(!Array.isArray(e))return!1;if(s<2)return!0;if(Array.isArray(e))for(let r=0;r<e.length&&r<s;r++)if(!this.scalar(e[r],t,n))return!1;return!0}mapKeys(e,t,s){let n=Object.keys(e);switch(t){case K.INT32:case K.FIXED32:case K.SFIXED32:case K.SINT32:case K.UINT32:return this.scalars(n.slice(0,s).map((e=>parseInt(e))),t,s);case K.BOOL:return this.scalars(n.slice(0,s).map((e=>"true"==e||"false"!=e&&e)),t,s);default:return this.scalars(n,t,s,G.STRING)}}}function Q(e,t){switch(t){case G.BIGINT:return e.toBigInt();case G.NUMBER:return e.toNumber();default:return e.toString()}}class z{constructor(e){this.info=e}prepare(){var e;if(void 0===this.fMap){this.fMap={};const t=null!==(e=this.info.fields)&&void 0!==e?e:[];for(const e of t)this.fMap[e.name]=e,this.fMap[e.jsonName]=e,this.fMap[e.localName]=e}}assert(e,t,s){if(!e){let e=h(s);throw"number"!=e&&"boolean"!=e||(e=s.toString()),new Error(`Cannot parse JSON ${e} for ${this.info.typeName}#${t}`)}}read(e,t,s){this.prepare();const n=[];for(const[r,a]of Object.entries(e)){const e=this.fMap[r];if(!e){if(!s.ignoreUnknownFields)throw new Error(`Found unknown field while reading ${this.info.typeName} from JSON format. JSON key: ${r}`);continue}const i=e.localName;let o;if(e.oneof){if(null===a&&("enum"!==e.kind||"google.protobuf.NullValue"!==e.T()[0]))continue;if(n.includes(e.oneof))throw new Error(`Multiple members of the oneof group "${e.oneof}" of ${this.info.typeName} are present in JSON.`);n.push(e.oneof),o=t[e.oneof]={oneofKind:i}}else o=t;if("map"==e.kind){if(null===a)continue;this.assert(f(a),e.name,a);const t=o[i];for(const[n,r]of Object.entries(a)){let a;switch(this.assert(null!==r,e.name+" map value",null),e.V.kind){case"message":a=e.V.T().internalJsonRead(r,s);break;case"enum":if(a=this.enum(e.V.T(),r,e.name,s.ignoreUnknownFields),!1===a)continue;break;case"scalar":a=this.scalar(r,e.V.T,e.V.L,e.name)}this.assert(void 0!==a,e.name+" map value",r);let i=n;e.K==K.BOOL&&(i="true"==i||"false"!=i&&i),i=this.scalar(i,e.K,G.STRING,e.name).toString(),t[i]=a}}else if(e.repeat){if(null===a)continue;this.assert(Array.isArray(a),e.name,a);const t=o[i];for(const n of a){let r;switch(this.assert(null!==n,e.name,null),e.kind){case"message":r=e.T().internalJsonRead(n,s);break;case"enum":if(r=this.enum(e.T(),n,e.name,s.ignoreUnknownFields),!1===r)continue;break;case"scalar":r=this.scalar(n,e.T,e.L,e.name)}this.assert(void 0!==r,e.name,a),t.push(r)}}else switch(e.kind){case"message":if(null===a&&"google.protobuf.Value"!=e.T().typeName){this.assert(void 0===e.oneof,e.name+" (oneof member)",null);continue}o[i]=e.T().internalJsonRead(a,s,o[i]);break;case"enum":let t=this.enum(e.T(),a,e.name,s.ignoreUnknownFields);if(!1===t)continue;o[i]=t;break;case"scalar":o[i]=this.scalar(a,e.T,e.L,e.name)}}}enum(e,t,s,n){if("google.protobuf.NullValue"==e[0]&&j(null===t||"NULL_VALUE"===t,`Unable to parse field ${this.info.typeName}#${s}, enum ${e[0]} only accepts null.`),null===t)return 0;switch(typeof t){case"number":return j(Number.isInteger(t),`Unable to parse field ${this.info.typeName}#${s}, enum can only be integral number, got ${t}.`),t;case"string":let r=t;e[2]&&t.substring(0,e[2].length)===e[2]&&(r=t.substring(e[2].length));let a=e[1][r];return(void 0!==a||!n)&&(j("number"==typeof a,`Unable to parse field ${this.info.typeName}#${s}, enum ${e[0]} has no value for "${t}".`),a)}j(!1,`Unable to parse field ${this.info.typeName}#${s}, cannot parse enum value from ${typeof t}".`)}scalar(e,t,s,n){let r;try{switch(t){case K.DOUBLE:case K.FLOAT:if(null===e)return 0;if("NaN"===e)return Number.NaN;if("Infinity"===e)return Number.POSITIVE_INFINITY;if("-Infinity"===e)return Number.NEGATIVE_INFINITY;if(""===e){r="empty string";break}if("string"==typeof e&&e.trim().length!==e.length){r="extra whitespace";break}if("string"!=typeof e&&"number"!=typeof e)break;let n=Number(e);if(Number.isNaN(n)){r="not a number";break}if(!Number.isFinite(n)){r="too large or small";break}return t==K.FLOAT&&F(n),n;case K.INT32:case K.FIXED32:case K.SFIXED32:case K.SINT32:case K.UINT32:if(null===e)return 0;let a;if("number"==typeof e?a=e:""===e?r="empty string":"string"==typeof e&&(e.trim().length!==e.length?r="extra whitespace":a=Number(e)),void 0===a)break;return t==K.UINT32?D(a):L(a),a;case K.INT64:case K.SFIXED64:case K.SINT64:if(null===e)return Q(A.ZERO,s);if("number"!=typeof e&&"string"!=typeof e)break;return Q(A.from(e),s);case K.FIXED64:case K.UINT64:if(null===e)return Q(U.ZERO,s);if("number"!=typeof e&&"string"!=typeof e)break;return Q(U.from(e),s);case K.BOOL:if(null===e)return!1;if("boolean"!=typeof e)break;return e;case K.STRING:if(null===e)return"";if("string"!=typeof e){r="extra whitespace";break}try{encodeURIComponent(e)}catch(r){r="invalid UTF8";break}return e;case K.BYTES:if(null===e||""===e)return new Uint8Array(0);if("string"!=typeof e)break;return function(e){let t=3*e.length/4;"="==e[e.length-2]?t-=2:"="==e[e.length-1]&&(t-=1);let s,n=new Uint8Array(t),r=0,a=0,i=0;for(let t=0;t<e.length;t++){if(s=p[e.charCodeAt(t)],void 0===s)switch(e[t]){case"=":a=0;case"\n":case"\r":case"\t":case" ":continue;default:throw Error("invalid base64 string.")}switch(a){case 0:i=s,a=1;break;case 1:n[r++]=i<<2|(48&s)>>4,i=s,a=2;break;case 2:n[r++]=(15&i)<<4|(60&s)>>2,i=s,a=3;break;case 3:n[r++]=(3&i)<<6|s,a=0}}if(1==a)throw Error("invalid base64 string.");return n.subarray(0,r)}(e)}}catch(e){r=e.message}this.assert(!1,n+(r?" - "+r:""),e)}}class H{constructor(e){var t;this.fields=null!==(t=e.fields)&&void 0!==t?t:[]}write(e,t){const s={},n=e;for(const e of this.fields){if(!e.oneof){let r=this.field(e,n[e.localName],t);void 0!==r&&(s[t.useProtoFieldName?e.name:e.jsonName]=r);continue}const r=n[e.oneof];if(r.oneofKind!==e.localName)continue;const a="scalar"==e.kind||"enum"==e.kind?Object.assign(Object.assign({},t),{emitDefaultValues:!0}):t;let i=this.field(e,r[e.localName],a);j(void 0!==i),s[t.useProtoFieldName?e.name:e.jsonName]=i}return s}field(e,t,s){let n;if("map"==e.kind){j("object"==typeof t&&null!==t);const r={};switch(e.V.kind){case"scalar":for(const[s,n]of Object.entries(t)){const t=this.scalar(e.V.T,n,e.name,!1,!0);j(void 0!==t),r[s.toString()]=t}break;case"message":const n=e.V.T();for(const[a,i]of Object.entries(t)){const t=this.message(n,i,e.name,s);j(void 0!==t),r[a.toString()]=t}break;case"enum":const a=e.V.T();for(const[n,i]of Object.entries(t)){j(void 0===i||"number"==typeof i);const t=this.enum(a,i,e.name,!1,!0,s.enumAsInteger);j(void 0!==t),r[n.toString()]=t}}(s.emitDefaultValues||Object.keys(r).length>0)&&(n=r)}else if(e.repeat){j(Array.isArray(t));const r=[];switch(e.kind){case"scalar":for(let s=0;s<t.length;s++){const n=this.scalar(e.T,t[s],e.name,e.opt,!0);j(void 0!==n),r.push(n)}break;case"enum":const n=e.T();for(let a=0;a<t.length;a++){j(void 0===t[a]||"number"==typeof t[a]);const i=this.enum(n,t[a],e.name,e.opt,!0,s.enumAsInteger);j(void 0!==i),r.push(i)}break;case"message":const a=e.T();for(let n=0;n<t.length;n++){const i=this.message(a,t[n],e.name,s);j(void 0!==i),r.push(i)}}(s.emitDefaultValues||r.length>0||s.emitDefaultValues)&&(n=r)}else switch(e.kind){case"scalar":n=this.scalar(e.T,t,e.name,e.opt,s.emitDefaultValues);break;case"enum":n=this.enum(e.T(),t,e.name,e.opt,s.emitDefaultValues,s.enumAsInteger);break;case"message":n=this.message(e.T(),t,e.name,s)}return n}enum(e,t,s,n,r,a){if("google.protobuf.NullValue"==e[0])return r||n?null:void 0;if(void 0!==t){if(0!==t||r||n)return j("number"==typeof t),j(Number.isInteger(t)),a||!e[1].hasOwnProperty(t)?t:e[2]?e[2]+e[1][t]:e[1][t]}else j(n)}message(e,t,s,n){return void 0===t?n.emitDefaultValues?null:void 0:e.internalJsonWrite(t,n)}scalar(e,t,s,n,r){if(void 0===t)return void j(n);const a=r||n;switch(e){case K.INT32:case K.SFIXED32:case K.SINT32:return 0===t?a?0:void 0:(L(t),t);case K.FIXED32:case K.UINT32:return 0===t?a?0:void 0:(D(t),t);case K.FLOAT:F(t);case K.DOUBLE:return 0===t?a?0:void 0:(j("number"==typeof t),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t);case K.STRING:return""===t?a?"":void 0:(j("string"==typeof t),t);case K.BOOL:return!1===t?!a&&void 0:(j("boolean"==typeof t),t);case K.UINT64:case K.FIXED64:j("number"==typeof t||"string"==typeof t||"bigint"==typeof t);let e=U.from(t);if(e.isZero()&&!a)return;return e.toString();case K.INT64:case K.SFIXED64:case K.SINT64:j("number"==typeof t||"string"==typeof t||"bigint"==typeof t);let s=A.from(t);if(s.isZero()&&!a)return;return s.toString();case K.BYTES:return j(t instanceof Uint8Array),t.byteLength?function(e){let t,s="",n=0,r=0;for(let a=0;a<e.length;a++)switch(t=e[a],n){case 0:s+=d[t>>2],r=(3&t)<<4,n=1;break;case 1:s+=d[r|t>>4],r=(15&t)<<2,n=2;break;case 2:s+=d[r|t>>6],s+=d[63&t],n=0}return n&&(s+=d[r],s+="=",1==n&&(s+="=")),s}(t):a?"":void 0}}}function ee(e,t=G.STRING){switch(e){case K.BOOL:return!1;case K.UINT64:case K.FIXED64:return Q(U.ZERO,t);case K.INT64:case K.SFIXED64:case K.SINT64:return Q(A.ZERO,t);case K.DOUBLE:case K.FLOAT:return 0;case K.BYTES:return new Uint8Array(0);case K.STRING:return"";default:return 0}}class te{constructor(e){this.info=e}prepare(){var e;if(!this.fieldNoToField){const t=null!==(e=this.info.fields)&&void 0!==e?e:[];this.fieldNoToField=new Map(t.map((e=>[e.no,e])))}}read(e,t,s,n){this.prepare();const r=void 0===n?e.len:e.pos+n;for(;e.pos<r;){const[n,r]=e.tag(),a=this.fieldNoToField.get(n);if(!a){let a=s.readUnknownField;if("throw"==a)throw new Error(`Unknown field ${n} (wire type ${r}) for ${this.info.typeName}`);let i=e.skip(r);!1!==a&&(!0===a?m.onRead:a)(this.info.typeName,t,n,r,i);continue}let i=t,o=a.repeat,l=a.localName;switch(a.oneof&&(i=i[a.oneof],i.oneofKind!==l&&(i=t[a.oneof]={oneofKind:l})),a.kind){case"scalar":case"enum":let t="enum"==a.kind?K.INT32:a.T,n="scalar"==a.kind?a.L:void 0;if(o){let s=i[l];if(r==g.LengthDelimited&&t!=K.STRING&&t!=K.BYTES){let r=e.uint32()+e.pos;for(;e.pos<r;)s.push(this.scalar(e,t,n))}else s.push(this.scalar(e,t,n))}else i[l]=this.scalar(e,t,n);break;case"message":if(o){let t=i[l],n=a.T().internalBinaryRead(e,e.uint32(),s);t.push(n)}else i[l]=a.T().internalBinaryRead(e,e.uint32(),s,i[l]);break;case"map":let[c,u]=this.mapEntry(a,e,s);i[l][c]=u}}}mapEntry(e,t,s){let n,r,a=t.uint32(),i=t.pos+a;for(;t.pos<i;){let[a,i]=t.tag();switch(a){case 1:n=e.K==K.BOOL?t.bool().toString():this.scalar(t,e.K,G.STRING);break;case 2:switch(e.V.kind){case"scalar":r=this.scalar(t,e.V.T,e.V.L);break;case"enum":r=t.int32();break;case"message":r=e.V.T().internalBinaryRead(t,t.uint32(),s)}break;default:throw new Error(`Unknown field ${a} (wire type ${i}) in map entry for ${this.info.typeName}#${e.name}`)}}if(void 0===n){let t=ee(e.K);n=e.K==K.BOOL?t.toString():t}if(void 0===r)switch(e.V.kind){case"scalar":r=ee(e.V.T,e.V.L);break;case"enum":r=0;break;case"message":r=e.V.T().create()}return[n,r]}scalar(e,t,s){switch(t){case K.INT32:return e.int32();case K.STRING:return e.string();case K.BOOL:return e.bool();case K.DOUBLE:return e.double();case K.FLOAT:return e.float();case K.INT64:return Q(e.int64(),s);case K.UINT64:return Q(e.uint64(),s);case K.FIXED64:return Q(e.fixed64(),s);case K.FIXED32:return e.fixed32();case K.BYTES:return e.bytes();case K.UINT32:return e.uint32();case K.SFIXED32:return e.sfixed32();case K.SFIXED64:return Q(e.sfixed64(),s);case K.SINT32:return e.sint32();case K.SINT64:return Q(e.sint64(),s)}}}class se{constructor(e){this.info=e}prepare(){if(!this.fields){const e=this.info.fields?this.info.fields.concat():[];this.fields=e.sort(((e,t)=>e.no-t.no))}}write(e,t,s){this.prepare();for(const n of this.fields){let r,a,i=n.repeat,o=n.localName;if(n.oneof){const t=e[n.oneof];if(t.oneofKind!==o)continue;r=t[o],a=!0}else r=e[o],a=!1;switch(n.kind){case"scalar":case"enum":let e="enum"==n.kind?K.INT32:n.T;if(i)if(j(Array.isArray(r)),i==q.PACKED)this.packed(t,e,n.no,r);else for(const s of r)this.scalar(t,e,n.no,s,!0);else void 0===r?j(n.opt):this.scalar(t,e,n.no,r,a||n.opt);break;case"message":if(i){j(Array.isArray(r));for(const e of r)this.message(t,s,n.T(),n.no,e)}else this.message(t,s,n.T(),n.no,r);break;case"map":j("object"==typeof r&&null!==r);for(const[e,a]of Object.entries(r))this.mapEntry(t,s,n,e,a)}}let n=s.writeUnknownFields;!1!==n&&(!0===n?m.onWrite:n)(this.info.typeName,e,t)}mapEntry(e,t,s,n,r){e.tag(s.no,g.LengthDelimited),e.fork();let a=n;switch(s.K){case K.INT32:case K.FIXED32:case K.UINT32:case K.SFIXED32:case K.SINT32:a=Number.parseInt(n);break;case K.BOOL:j("true"==n||"false"==n),a="true"==n}switch(this.scalar(e,s.K,1,a,!0),s.V.kind){case"scalar":this.scalar(e,s.V.T,2,r,!0);break;case"enum":this.scalar(e,K.INT32,2,r,!0);break;case"message":this.message(e,t,s.V.T(),2,r)}e.join()}message(e,t,s,n,r){void 0!==r&&(s.internalBinaryWrite(r,e.tag(n,g.LengthDelimited).fork(),t),e.join())}scalar(e,t,s,n,r){let[a,i,o]=this.scalarInfo(t,n);o&&!r||(e.tag(s,a),e[i](n))}packed(e,t,s,n){if(!n.length)return;j(t!==K.BYTES&&t!==K.STRING),e.tag(s,g.LengthDelimited),e.fork();let[,r]=this.scalarInfo(t);for(let t=0;t<n.length;t++)e[r](n[t]);e.join()}scalarInfo(e,t){let s,n=g.Varint,r=void 0===t,a=0===t;switch(e){case K.INT32:s="int32";break;case K.STRING:a=r||!t.length,n=g.LengthDelimited,s="string";break;case K.BOOL:a=!1===t,s="bool";break;case K.UINT32:s="uint32";break;case K.DOUBLE:n=g.Bit64,s="double";break;case K.FLOAT:n=g.Bit32,s="float";break;case K.INT64:a=r||A.from(t).isZero(),s="int64";break;case K.UINT64:a=r||U.from(t).isZero(),s="uint64";break;case K.FIXED64:a=r||U.from(t).isZero(),n=g.Bit64,s="fixed64";break;case K.BYTES:a=r||!t.byteLength,n=g.LengthDelimited,s="bytes";break;case K.FIXED32:n=g.Bit32,s="fixed32";break;case K.SFIXED32:n=g.Bit32,s="sfixed32";break;case K.SFIXED64:a=r||A.from(t).isZero(),n=g.Bit64,s="sfixed64";break;case K.SINT32:s="sint32";break;case K.SINT64:a=r||A.from(t).isZero(),s="sint64"}return[n,s,r||a]}}function ne(e,t,s){let n,r,a=s;for(let s of e.fields){let e=s.localName;if(s.oneof){const i=a[s.oneof];if(null==(null==i?void 0:i.oneofKind))continue;if(n=i[e],r=t[s.oneof],r.oneofKind=i.oneofKind,null==n){delete r[e];continue}}else if(n=a[e],r=t,null==n)continue;switch(s.repeat&&(r[e].length=n.length),s.kind){case"scalar":case"enum":if(s.repeat)for(let t=0;t<n.length;t++)r[e][t]=n[t];else r[e]=n;break;case"message":let t=s.T();if(s.repeat)for(let s=0;s<n.length;s++)r[e][s]=t.create(n[s]);else void 0===r[e]?r[e]=t.create(n):t.mergePartial(r[e],n);break;case"map":switch(s.V.kind){case"scalar":case"enum":Object.assign(r[e],n);break;case"message":let t=s.V.T();for(let s of Object.keys(n))r[e][s]=t.create(n[s])}}}}const re=Object.values;function ae(e,t,s){if(t===s)return!0;if(e!==K.BYTES)return!1;let n=t,r=s;if(n.length!==r.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!=r[e])return!1;return!0}function ie(e,t,s){if(t.length!==s.length)return!1;for(let n=0;n<t.length;n++)if(!ae(e,t[n],s[n]))return!1;return!0}function oe(e,t,s){if(t.length!==s.length)return!1;for(let n=0;n<t.length;n++)if(!e.equals(t[n],s[n]))return!1;return!0}class le{constructor(e,t,s){this.defaultCheckDepth=16,this.typeName=e,this.fields=t.map(W),this.options=null!=s?s:{},this.messagePrototype=Object.defineProperty({},_,{value:this}),this.refTypeCheck=new Y(this),this.refJsonReader=new z(this),this.refJsonWriter=new H(this),this.refBinReader=new te(this),this.refBinWriter=new se(this)}create(e){let t=function(e){const t=e.messagePrototype?Object.create(e.messagePrototype):Object.defineProperty({},_,{value:e});for(let s of e.fields){let e=s.localName;if(!s.opt)if(s.oneof)t[s.oneof]={oneofKind:void 0};else if(s.repeat)t[e]=[];else switch(s.kind){case"scalar":t[e]=ee(s.T,s.L);break;case"enum":t[e]=0;break;case"map":t[e]={}}}return t}(this);return void 0!==e&&ne(this,t,e),t}clone(e){let t=this.create();return ne(this,t,e),t}equals(e,t){return function(e,t,s){if(t===s)return!0;if(!t||!s)return!1;for(let n of e.fields){let e=n.localName,r=n.oneof?t[n.oneof][e]:t[e],a=n.oneof?s[n.oneof][e]:s[e];switch(n.kind){case"enum":case"scalar":let e="enum"==n.kind?K.INT32:n.T;if(!(n.repeat?ie(e,r,a):ae(e,r,a)))return!1;break;case"map":if(!("message"==n.V.kind?oe(n.V.T(),re(r),re(a)):ie("enum"==n.V.kind?K.INT32:n.V.T,re(r),re(a))))return!1;break;case"message":let t=n.T();if(!(n.repeat?oe(t,r,a):t.equals(r,a)))return!1}}return!0}(this,e,t)}is(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!1)}isAssignable(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!0)}mergePartial(e,t){ne(this,e,t)}fromBinary(e,t){let s=function(e){return e?Object.assign(Object.assign({},x),e):x}(t);return this.internalBinaryRead(s.readerFactory(e),e.byteLength,s)}fromJson(e,t){return this.internalJsonRead(e,function(e){return e?Object.assign(Object.assign({},X),e):X}(t))}fromJsonString(e,t){let s=JSON.parse(e);return this.fromJson(s,t)}toJson(e,t){return this.internalJsonWrite(e,J(t))}toJsonString(e,t){var s;let n=this.toJson(e,t);return JSON.stringify(n,null,null!==(s=null==t?void 0:t.prettySpaces)&&void 0!==s?s:0)}toBinary(e,t){let s=function(e){return e?Object.assign(Object.assign({},R),e):R}(t);return this.internalBinaryWrite(e,s.writerFactory(),s).finish()}internalJsonRead(e,t,s){if(null!==e&&"object"==typeof e&&!Array.isArray(e)){let n=null!=s?s:this.create();return this.refJsonReader.read(e,n,t),n}throw new Error(`Unable to parse message ${this.typeName} from JSON ${h(e)}.`)}internalJsonWrite(e,t){return this.refJsonWriter.write(e,t)}internalBinaryWrite(e,t,s){return this.refBinWriter.write(e,t,s),t}internalBinaryRead(e,t,s,n){let r=null!=n?n:this.create();return this.refBinReader.read(e,r,s,t),r}}const ce=new s("🍿️ DualSubs: 🎵 Spotify v1.5.1(4) response"),ue=class{static name="URI";static version="1.2.7";static about(){return console.log(`\n🟧 ${this.name} v${this.version}\n`)}static#r={scheme:"",host:"",path:"",query:{}};static parse(e){let t=e.match(/(?:(?<scheme>.+):\/\/(?<host>[^/]+))?\/?(?<path>[^?]+)?\??(?<query>[^?]+)?/)?.groups??null;if(t?.path?t.paths=t.path.split("/"):t.path="",t?.paths){const e=t.paths[t.paths.length-1];if(e?.includes(".")){const s=e.split(".");t.format=s[s.length-1]}}return t?.query&&(t.query=Object.fromEntries(t.query.split("&").map((e=>e.split("="))))),t}static stringify(e=this.#r){let t="";return e?.scheme&&e?.host&&(t+=e.scheme+"://"+e.host),e?.path&&(t+=e?.host?"/"+e.path:e.path),e?.query&&(t+="?"+Object.entries(e.query).map((e=>e.join("="))).join("&")),t}}.parse($request.url);ce.log(`⚠ URL: ${JSON.stringify(ue)}`,"");const he=$request.method;ue.host;const fe=ue.path;ue.paths,ce.log(`⚠ METHOD: ${he}`,"");const de=($response.headers?.["Content-Type"]??$response.headers?.["content-type"])?.split(";")?.[0];ce.log(`⚠ FORMAT: ${de}`,""),(async()=>{const{Settings:e,Caches:s,Configs:n}=c("DualSubs","Spotify",l);switch(ce.log(`⚠ Settings.Switch: ${e?.Switch}`,""),e.Switch){case!0:default:const n=ue.query?.subtype??e.Type,r=[ue.query?.lang?.toUpperCase?.()??e.Languages[0],(ue.query?.tlang??s?.tlang)?.toUpperCase?.()??e.Languages[1]];ce.log(`⚠ Type: ${n}, Languages: ${r}`,"");let a={};switch(de){case void 0:case"application/x-www-form-urlencoded":case"text/plain":case"text/html":default:case"application/x-mpegURL":case"application/x-mpegurl":case"application/vnd.apple.mpegurl":case"audio/mpegurl":case"text/xml":case"text/plist":case"application/xml":case"application/plist":case"application/x-plist":case"text/vtt":case"application/vtt":break;case"text/json":case"application/json":switch(a=JSON.parse($response.body??"{}"),ce.log(`🚧 body: ${JSON.stringify(a)}`,""),fe){case"melody/v1/product_state":a.country=e.Country,a["selected-language"]=e.Languages[1].toLowerCase();break;case"v1/tracks":a?.tracks?.forEach?.((e=>{ce.log(`🚧 track: ${JSON.stringify(e)}`,"");const t=e?.id,n={track:e?.name,album:e?.album?.name,artist:e?.artists?.[0]?.name};s.Metadatas.Tracks.set(t,n)})),s.Metadatas.Tracks=function(e,t=100){return console.log(`☑️ Set Cache, cacheSize: ${t}`,""),e=(e=Array.from(e||[])).slice(-t),console.log("✅ Set Cache",""),e}(s.Metadatas.Tracks,e.CacheSize),t.setItem("@DualSubs.Spotify.Caches.Metadatas.Tracks",s.Metadatas.Tracks)}$response.body=JSON.stringify(a);break;case"application/protobuf":case"application/x-protobuf":case"application/vnd.google.protobuf":case"application/grpc":case"application/grpc+proto":case"application/octet-stream":let n=ce.isQuanX()?new Uint8Array($response.bodyBytes??[]):$response.body??new Uint8Array;switch(de){case"application/protobuf":case"application/x-protobuf":case"application/vnd.google.protobuf":class t extends le{constructor(){super("google.protobuf.Any",[{no:1,name:"type_url",kind:"scalar",T:9},{no:2,name:"value",kind:"scalar",T:12}])}pack(e,t){return{typeUrl:this.typeNameToUrl(t.typeName),value:t.toBinary(e)}}unpack(e,t,s){if(!this.contains(e,t))throw new Error("Cannot unpack google.protobuf.Any with typeUrl '"+e.typeUrl+"' as "+t.typeName+".");return t.fromBinary(e.value,s)}contains(e,t){if(!e.typeUrl.length)return!1;return("string"==typeof t?t:t.typeName)===this.typeUrlToName(e.typeUrl)}internalJsonWrite(e,t){if(""===e.typeUrl)return{};let s=this.typeUrlToName(e.typeUrl),n=J(t),r=n.typeRegistry?.find((e=>e.typeName===s));if(!r)throw new globalThis.Error("Unable to convert google.protobuf.Any with typeUrl '"+e.typeUrl+"' to JSON. The specified type "+s+" is not available in the type registry.");let a=r.fromBinary(e.value,{readUnknownField:!1}),i=r.internalJsonWrite(a,n);return!s.startsWith("google.protobuf.")&&f(i)||(i={value:i}),i["@type"]=e.typeUrl,i}internalJsonRead(e,t,s){if(!f(e))throw new globalThis.Error("Unable to parse google.protobuf.Any from JSON "+h(e)+".");if("string"!=typeof e["@type"]||""==e["@type"])return this.create();let n,r=this.typeUrlToName(e["@type"]),a=t?.typeRegistry?.find((e=>e.typeName==r));if(!a)throw new globalThis.Error("Unable to parse google.protobuf.Any from JSON. The specified type "+r+" is not available in the type registry.");if(r.startsWith("google.protobuf.")&&e.hasOwnProperty("value"))n=a.fromJson(e.value,t);else{let s=Object.assign({},e);delete s["@type"],n=a.fromJson(s,t)}return void 0===s&&(s=this.create()),s.typeUrl=e["@type"],s.value=a.toBinary(n),s}typeNameToUrl(e){if(!e.length)throw new Error("invalid type name: "+e);return"type.googleapis.com/"+e}typeUrlToName(e){if(!e.length)throw new Error("invalid type url: "+e);let t=e.lastIndexOf("/"),s=t>0?e.substring(t+1):e;if(!s.length)throw new Error("invalid type url: "+e);return s}create(e){const t={typeUrl:"",value:new Uint8Array(0)};return globalThis.Object.defineProperty(t,_,{enumerable:!1,value:this}),void 0!==e&&ne(this,t,e),t}internalBinaryRead(e,t,s,n){let r=n??this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:r.typeUrl=e.string();break;case 2:r.value=e.bytes();break;default:let a=s.readUnknownField;if("throw"===a)throw new globalThis.Error(`Unknown field ${t} (wire type ${n}) for ${this.typeName}`);let i=e.skip(n);!1!==a&&(!0===a?m.onRead:a)(this.typeName,r,t,n,i)}}return r}internalBinaryWrite(e,t,s){""!==e.typeUrl&&t.tag(1,g.LengthDelimited).string(e.typeUrl),e.value.length&&t.tag(2,g.LengthDelimited).bytes(e.value);let n=s.writeUnknownFields;return!1!==n&&(1==n?m.onWrite:n)(this.typeName,e,t),t}}const s=new t;switch(fe){case"bootstrap/v1/bootstrap":case"user-customization-service/v1/customize":class t extends le{constructor(){super("BootstrapResponse",[{no:2,name:"ucsResponseV0",kind:"message",T:()=>o},{no:3,name:"trialsFacadeResponseV1",kind:"message",T:()=>p}])}}const r=new t;class i extends le{constructor(){super("UcsResponseWrapperV0",[{no:1,name:"success",kind:"message",T:()=>c},{no:2,name:"error",kind:"message",T:()=>M}])}}const o=new i;class l extends le{constructor(){super("UcsResponseWrapperSuccess",[{no:1,name:"customization",kind:"message",T:()=>f}])}}const c=new l;class h extends le{constructor(){super("UcsResponseWrapper",[{no:1,name:"success",kind:"message",T:()=>b},{no:2,name:"error",kind:"message",T:()=>M}])}}const f=new h;class d extends le{constructor(){super("TrialsFacadeResponseWrapperV1",[{no:1,name:"success",kind:"message",T:()=>g},{no:2,name:"error",kind:"message",T:()=>M}])}}const p=new d;class m extends le{constructor(){super("TrialsFacadeResponseWrapperSuccess",[{no:1,name:"filed1",kind:"scalar",T:5}])}}const g=new m;class y extends le{constructor(){super("UcsResponse",[{no:1,name:"resolveSuccess",kind:"message",T:()=>k},{no:2,name:"resolveError",kind:"message",T:()=>M},{no:3,name:"accountAttributesSuccess",kind:"message",T:()=>D},{no:4,name:"accountAttributesError",kind:"message",T:()=>M},{no:5,name:"fetchTimeMillis",kind:"scalar",T:3}])}}const b=new y;class w extends le{constructor(){super("ResolveSuccess",[{no:1,name:"configuration",kind:"message",T:()=>N}])}}const k=new w;class T extends le{constructor(){super("Configuration",[{no:1,name:"configurationAssignmentId",kind:"scalar",T:9},{no:2,name:"fetchTimeMillis",kind:"scalar",T:3},{no:3,name:"assignedValues",kind:"message",repeat:1,T:()=>I}])}}const N=new T;class S extends le{constructor(){super("AssignedValue",[{no:1,name:"propertyId",kind:"message",T:()=>E},{no:2,name:"metadata",kind:"message",T:()=>B},{no:3,name:"boolValue",kind:"message",T:()=>U},{no:4,name:"intValue",kind:"message",T:()=>j},{no:5,name:"enumValue",kind:"message",T:()=>x}])}}const I=new S;class v extends le{constructor(){super("PropertyId",[{no:1,name:"scope",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9}])}}const E=new v;class O extends le{constructor(){super("Metadata",[{no:1,name:"policyId",kind:"scalar",T:3},{no:2,name:"externalRealm",kind:"scalar",T:9},{no:3,name:"externalRealmId",kind:"scalar",T:3}])}}const B=new O;class V extends le{constructor(){super("BoolValue",[{no:1,name:"value",kind:"scalar",T:8}])}}const U=new V;class A extends le{constructor(){super("EnumValue",[{no:1,name:"value",kind:"scalar",T:9}])}}const x=new A;class $ extends le{constructor(){super("IntValue",[{no:1,name:"value",kind:"scalar",T:5}])}}const j=new $;class L extends le{constructor(){super("AccountAttributesResponse",[{no:1,name:"accountAttributes",kind:"map",K:9,V:{kind:"message",T:()=>R}}])}}const D=new L;class F extends le{constructor(){super("AccountAttribute",[{no:2,name:"boolValue",kind:"scalar",opt:!0,T:8},{no:3,name:"longValue",kind:"scalar",opt:!0,T:3},{no:4,name:"stringValue",kind:"scalar",opt:!0,T:9}])}}const R=new F;class C extends le{constructor(){super("Error",[{no:1,name:"errorCode",kind:"scalar",T:5},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"logId",kind:"scalar",opt:!0,T:9}])}}const M=new C;switch(fe){case"bootstrap/v1/bootstrap":{a=r.fromBinary(n);let t=a?.ucsResponseV0?.success?.customization?.success?.accountAttributesSuccess?.accountAttributes;t&&(t.country_code={stringValue:e.Country},t=u(t)),n=r.toBinary(a);break}case"user-customization-service/v1/customize":{a=f.fromBinary(n);let t=a?.success?.accountAttributesSuccess?.accountAttributes;t&&(t.country_code={stringValue:e.Country},t=u(t)),n=f.toBinary(a);break}}break;case"extended-metadata/v0/extended-metadata":{class e extends le{constructor(){super("BatchedExtensionResponse",[{no:1,name:"header",kind:"message",T:()=>i},{no:2,name:"extended_metadata",kind:"message",repeat:1,T:()=>u}])}}const t=new e;class r extends le{constructor(){super("BatchedExtensionResponseHeader",[])}}const i=new r;class o extends le{constructor(){super("EntityExtensionDataArrayHeader",[{no:1,name:"provider_error_status",kind:"scalar",T:5},{no:2,name:"cache_ttl_in_seconds",kind:"scalar",T:3},{no:3,name:"offline_ttl_in_seconds",kind:"scalar",T:3}])}}const l=new o;class c extends le{constructor(){super("EntityExtensionDataArray",[{no:1,name:"header",kind:"message",T:()=>l},{no:3,name:"extension_data",kind:"message",repeat:1,T:()=>f}])}}const u=new c;class h extends le{constructor(){super("EntityExtensionData",[{no:1,name:"header",kind:"message",T:()=>p},{no:2,name:"entity_uri",kind:"scalar",T:9},{no:3,name:"extension_data",kind:"message",T:()=>s}])}}const f=new h;class d extends le{constructor(){super("EntityExtensionDataHeader",[{no:1,name:"status_code",kind:"scalar",T:5},{no:2,name:"etag",kind:"scalar",T:9},{no:3,name:"locale",kind:"scalar",T:9},{no:4,name:"cache_ttl_in_seconds",kind:"scalar",T:3},{no:5,name:"offline_ttl_in_seconds",kind:"scalar",T:3}])}}const p=new d;a=t.fromBinary(n),n=t.toBinary(a);break}}}$response.body=n}case!1:}})().catch((e=>ce.logErr(e))).finally((()=>ce.done($response)));
